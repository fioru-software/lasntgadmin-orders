!function(){"use strict";var e={n:function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,{a:a}),a},d:function(t,a){for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.element,a=window.wp.components,r=window.wp.apiFetch,n=e.n(r);const s=e=>{const[r,s]=(0,t.useState)(null),[l,d]=(0,t.useState)([]),[o,i]=(0,t.useState)(null),[u,c]=(0,t.useState)(!0),[m,p]=(0,t.useState)(!1);return(0,t.useEffect)((()=>{e.groupId&&s(e.groupId)}),[e.groupId]),(0,t.useEffect)((async()=>{try{c(!0),p(!0),n().use(n().createNonceMiddleware(e.nonce));const t=await n()({path:`${e.apiPath}`,method:"GET"});t.length||i({status:"warning",message:"You are not a member of any groups."}),d(t)}catch(e){i({status:"error",message:e.message}),console.error(e)}c(!1),e.groupId||p(!1)}),[]),(0,t.createElement)(t.Fragment,null,o&&(0,t.createElement)(a.Notice,{status:o.status,isDismissable:!0,onDismiss:()=>i(null)},o.message),u&&(0,t.createElement)(a.Spinner,null),!u&&(0,t.createElement)("select",{id:e.id,disabled:m,required:!0,onChange:function(t){e.setGroupId(t.target.value)},value:r},!r&&(0,t.createElement)("option",{selected:!0,disabled:!0,value:""},"Please select"),l.map((e=>(0,t.createElement)("option",{key:e.group_id.toString(),value:e.group_id},e.name)))),(0,t.createElement)("input",{type:"hidden",name:e.name,value:r}))};function l(e,t){const a=t.find((t=>t.key===`_quotas_field_${e}`));return void 0===a?0:a.value}const d=e=>{const[r,s]=(0,t.useState)(!0),[d,o]=(0,t.useState)(!1);function i(t){e.disabled||o(t)}return(0,t.useEffect)((()=>{o(e.disabled)}),[e.disabled]),(0,t.useEffect)((async()=>{try{s(!0),i(!0),n().use(n().createNonceMiddleware(e.nonce));const t=await n()({path:`${e.apiPath}/${e.groupId}`,method:"GET"});t.length||e.setNotice({status:"error",message:"No products are available for this group."}),e.setProducts(t)}catch(t){e.setNotice({status:"error",message:t.message}),console.error(t)}s(!1),i(!1)}),[e.groupId]),(0,t.createElement)(t.Fragment,null,r&&(0,t.createElement)(a.Spinner,null),!r&&(0,t.createElement)("select",{id:e.id,disabled:d,required:!0,onChange:e.onChange,value:null==e?void 0:e.productId},(0,t.createElement)("option",{selected:!0,disabled:!0,value:""},"Please select"),e.products.map((a=>{return(0,t.createElement)("option",{key:a.id.toString(),"data-stock":a.stock_quantity,"data-spaces":(r=a.stock_quantity,n=l(e.groupId,(s=a.meta_data,s.filter((e=>/_quotas_field_[\d]+/.test(e.key))))),r=parseInt(r),n=parseInt(n),isNaN(r)?0:isNaN(n)?r:0===n?n:n>r?r:n),"data-price":a.price,value:a.id},a.name);var r,n,s}))),(0,t.createElement)("input",{type:"hidden",name:e.name,value:null==e?void 0:e.productId}))},o=e=>{const a=(0,t.useRef)(null);return(0,t.createElement)("input",{name:e.name,id:e.id,type:"text",ref:a,defaultValue:e.default,required:e.required,pattern:e.pattern,disabled:e.disabled})},i=e=>{var r,n,s,l;const[o,i]=(0,t.useState)(null),[u,c]=(0,t.useState)(0),[m,p]=(0,t.useState)(0),[f,E]=(0,t.useState)(0),[g,v]=(0,t.useState)([]),[_,h]=(0,t.useState)(0),[y,b]=(0,t.useState)(0),[I,S]=(0,t.useState)(null);return(0,t.useEffect)((()=>{i(null),c(null)}),[null==e?void 0:e.groupId]),(0,t.useEffect)((()=>{var t;null!=e&&null!==(t=e.lineItem)&&void 0!==t&&t.id&&S(e.lineItem.id)}),[null==e||null===(r=e.lineItem)||void 0===r?void 0:r.id]),(0,t.createElement)(t.Fragment,null,o&&(0,t.createElement)(a.Notice,{status:o.status,isDismissable:!0,onDismiss:()=>i(null)},o.message),(0,t.createElement)("div",{class:"form-wrap"},(0,t.createElement)("h3",null,"Product"),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"product"},"Product"),(0,t.createElement)(d,{id:"product",name:"product",disabled:!(null==e||null===(n=e.lineItem)||void 0===n||!n.id),groupId:e.groupId,productId:I,apiPath:e.apiPath,nonce:e.nonce,setNotice:i,onChange:function(t){const a=t.target.querySelector(`option[value="${t.target.value}"]`),r=parseInt(a.dataset.stock),n=parseInt(a.dataset.price),s=parseInt(a.dataset.spaces);c(n),h(s),b(r),p(0),E(0),S(a.value),s<1&&r>0?e.setStatus("waiting-list"):e.setStatus(e.order.status),i(r?{status:parseInt(a.dataset.spaces)>0?"info":"warning",message:`${a.dataset.spaces} spaces available.`}:{status:"error",message:"Out of stock"})},setProducts:function(t){if(v(t),null!=e&&e.lineItem){const a=t.find((t=>e.lineItem.product_id===t.id)),r=parseInt(a.price);c(r),p(e.lineItem.quantity),E(r*e.lineItem.quantity),S(e.lineItem.id)}},products:g})),(null==e||null===(s=e.lineItem)||void 0===s?void 0:s.id)&&(0,t.createElement)("input",{type:"hidden",name:"line_item_id",value:e.lineItem.id}),!!u&&g.length>0&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"price"},"Price"),(0,t.createElement)("input",{id:"price",type:"number",disabled:!0,placeholder:"0",value:u}),(0,t.createElement)("input",{type:"hidden",name:"price",value:u})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"quantity"},"Quantity"),(0,t.createElement)("input",{id:"quantity",type:"number",disabled:!(null==e||null===(l=e.lineItem)||void 0===l||!l.id),step:"1",min:"1",max:_>0?_:y,autocomplete:"off",placeholder:"0",onChange:function(e){const t=parseInt(e.target.value);p(t),E(t*u)},value:m,required:!0}),(0,t.createElement)("input",{type:"hidden",name:"quantity",value:m})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"total"},"Total"),(0,t.createElement)("input",{id:"total",type:"number",disabled:!0,placeholder:"0",value:f}),(0,t.createElement)("input",{type:"hidden",name:"total",value:f})))))},u=e=>{const[a,r]=(0,t.useState)(!1);return(0,t.useEffect)((()=>{e.selected===e.value&&r(!0)}),[e.selected]),(0,t.createElement)("option",{key:e.value,selected:a,value:e.value},e.children)},c=e=>{var r;const[s,l]=(0,t.useState)([]),[d,o]=(0,t.useState)(null),[i,c]=(0,t.useState)(!0),[m,p]=(0,t.useState)(!0);return(0,t.useEffect)((()=>{var t,a,r;"auto-draft"!==(null==e||null===(t=e.order)||void 0===t?void 0:t.status)&&null!=e&&null!==(a=e.user)&&void 0!==a&&null!==(r=a.allcaps)&&void 0!==r&&r.view_others_shop_orders&&p(!1)}),[null==e||null===(r=e.order)||void 0===r?void 0:r.status]),(0,t.useEffect)((()=>{}),[e.status]),(0,t.useEffect)((async()=>{try{c(!0),n().use(n().createNonceMiddleware(e.nonce));const t=await n()({path:`${e.apiPath}/statuses`,method:"GET"});t.length||o({status:"warning",message:"Failed fetching order statuses."}),l(t)}catch(e){o({status:"error",message:e.message}),console.error(e)}c(!1)}),[]),(0,t.createElement)(t.Fragment,null,d&&(0,t.createElement)(a.Notice,{status:d.status,isDismissable:!0,onDismiss:()=>o(null)},d.message),i&&(0,t.createElement)(a.Spinner,null),!i&&(0,t.createElement)("select",{id:e.id,disabled:m,required:!0,value:e.status,onChange:function(t){e.setStatus(t.target.value)}},"auto-draft"===e.status&&(0,t.createElement)("option",{selected:!0,value:"auto-draft"},"Draft"),"auto-draft"!==e.status&&(0,t.createElement)("option",{selected:!0,disabled:!0,value:""},"Please select"),s.map((e=>(0,t.createElement)(u,{value:e.id},e.name)))),"auto-draft"!==e.status&&(0,t.createElement)("input",{type:"hidden",name:e.name,value:null==e?void 0:e.status}))},m=e=>{const[a,r]=(0,t.useState)([]);return(0,t.useEffect)((()=>{r([{code:"CW",name:"Carlow"},{code:"CN",name:"Cavan"},{code:"CE",name:"Clare"},{code:"CO",name:"Cork"},{code:"DL",name:"Donegal"},{code:"D",name:"Dublin"},{code:"G",name:"Galway"},{code:"KY",name:"Kerry"},{code:"KE",name:"Kildare"},{code:"KK",name:"Kilkenny"},{code:"LS",name:"Laois"},{code:"LM",name:"Leitrim"},{code:"LK",name:"Limerick"},{code:"LD",name:"Longford"},{code:"LH",name:"Louth"},{code:"MO",name:"Mayo"},{code:"MH",name:"Meath"},{code:"MN",name:"Monaghan"},{code:"OY",name:"Offaly"},{code:"RN",name:"Roscommon"},{code:"SO",name:"Sligo"},{code:"TA",name:"Tipperary"},{code:"WD",name:"Waterford"},{code:"WH",name:"Westmeath"},{code:"WX",name:"Wexford"},{code:"WW",name:"Wicklow"}])}),[]),(0,t.createElement)("select",{id:e.id,name:e.name,required:!0},!e.selected&&(0,t.createElement)("option",{selected:!0,disabled:!0,value:""},"Please select"),a.map((a=>e.selected===a.code?(0,t.createElement)("option",{selected:!0,key:a.code,value:a.code},a.name):(0,t.createElement)("option",{key:a.code,value:a.code},a.name))))},p=e=>(0,t.createElement)("address",null,(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"address_1"},"Address line 1"),(0,t.createElement)(o,{name:"address_1",id:"address_1",default:e.order.billing.address_1||e.userMeta.billing_address_1,required:!0})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"address_2"},"Address line 2"),(0,t.createElement)(o,{name:"address_2",id:"address_2",default:e.order.billing.address_2||e.userMeta.billing_address_2,required:!0})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"city"},"City"),(0,t.createElement)(o,{name:"city",id:"city",default:e.order.billing.city||e.userMeta.billing_city,required:!0})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"postcode"},"Eircode"),(0,t.createElement)(o,{name:"postcode",id:"postcode",default:e.order.billing.postcode||e.userMeta.billing_postcode,required:!0})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"country"},"Country"),(0,t.createElement)("select",{id:"country",name:"country",required:!0},(0,t.createElement)("option",{value:"IE",selected:"selected"},"Ireland"))),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"state"},"County"),(0,t.createElement)(m,{id:"state",name:"state",selected:e.order.billing.state||e.userMeta.billing_state}))),f=e=>{var r,l;const[d,u]=(0,t.useState)(null),[m,f]=(0,t.useState)(null),[E,g]=(0,t.useState)({}),[v,_]=(0,t.useState)(!1),[h,y]=(0,t.useState)(!1),[b,I]=(0,t.useState)(""),[S,w]=(0,t.useState)("Create");return(0,t.useEffect)((()=>{f(e.groupId)}),[e.groupId]),(0,t.useEffect)((()=>{I(e.status),"auto-draft"!==e.status&&w("Update")}),[e.status]),(0,t.useEffect)((()=>{"waiting-list"===b?w("Add to waiting list"):"auto-draft"===(null==e?void 0:e.status)?w("Create"):w("Update")}),[b]),(0,t.useEffect)((()=>{g(e.order.line_items[0])}),e.order.line_items),(0,t.useEffect)((async()=>{}),[null==e||null===(r=e.order)||void 0===r?void 0:r.id]),(0,t.useEffect)((async()=>{}),[null==e||null===(l=e.user)||void 0===l?void 0:l.id]),(0,t.useEffect)((()=>{null!=e&&e.user}),[null==e?void 0:e.user]),(0,t.useEffect)((()=>{null!=e&&e.userMeta}),[null==e?void 0:e.userMeta]),(0,t.createElement)("form",{class:"panel-wrap woocommerce",onSubmit:async function(t){t.preventDefault();const a=function(e){const t={billing:{first_name:e.get("first_name"),last_name:e.get("last_name"),address_1:e.get("address_1"),address_2:e.get("address_2"),city:e.get("city"),state:e.get("state"),postcode:e.get("postcode"),country:e.get("country"),email:e.get("email"),phone:e.get("phone")},shipping:{},currency:e.get("currency"),customer_id:e.get("customer_id"),status:e.get("order_status"),meta_data:[{key:"groups-read",value:e.get("order_group")}],line_items:[{product_id:parseInt(e.get("product")),quantity:parseInt(e.get("quantity"))}]};return null!=E&&E.order_id&&(t.line_items=[{...t.line_items[0],id:E.id,order_id:E.order_id,price:parseInt(e.get("price")),subtotal:`${e.get("subtotal")}`,total:`${e.get("total")}`}]),t}(new FormData(t.target));try{u(null),_(!0),y(!0),n().use(n().createNonceMiddleware(e.nonce)),e.order=await n()({path:e.order.date_created?`/wc/v3/orders/${e.order.id}`:"/wc/v3/orders",method:e.order.date_created?"PUT":"POST",data:a}),u({status:"success",message:"auto-draft"===(null==e?void 0:e.status)?"Order created. Redirecting...":"Order updated. Redirecting..."}),document.location.assign("/wp-admin/edit.php?post_type=shop_order")}catch(t){u({status:"error",message:t.message}),console.error(t),_(!1),y(!1)}}},(0,t.createElement)("input",{type:"hidden",name:"email",value:e.order.billing.email||e.user.data.user_email}),(0,t.createElement)("input",{type:"hidden",name:"currency",value:e.order.currency||e.currency}),(0,t.createElement)("input",{type:"hidden",name:"customer_id",value:e.order.customer_id||e.user.ID}),(0,t.createElement)("div",{id:"order_data",class:"panel woocommerce-order-data"},(0,t.createElement)("div",{class:"form-wrap"},(0,t.createElement)("h3",null,"Personal"),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"first_name"},"First name"),(0,t.createElement)(o,{name:"first_name",id:"first_name",default:e.order.billing.first_name||e.userMeta.first_name,required:!0})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"last_name"},"Last name"),(0,t.createElement)(o,{name:"last_name",id:"last_name",default:e.order.billing.last_name||e.userMeta.last_name,required:!0})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"phone"},"Phone"),(0,t.createElement)(o,{name:"phone",id:"phone",default:e.order.billing.phone||e.userMeta.billing_phone,required:!0}))),(0,t.createElement)("div",{class:"form-wrap"},(0,t.createElement)("h3",null,"Address"),(0,t.createElement)(p,{order:e.order,userMeta:e.userMeta})),(0,t.createElement)("div",{class:"form-wrap"},(0,t.createElement)("h3",null,"Order"),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"order_status"},"Status"),(0,t.createElement)(c,{id:"order_status",name:"order_status",user:null==e?void 0:e.user,order:null==e?void 0:e.order,status:b,setStatus:I,apiPath:e.orderApiPath,nonce:e.nonce})),(0,t.createElement)("div",{class:"form-field"},(0,t.createElement)("label",{for:"order_group"},"Order group"),(0,t.createElement)(s,{groupId:m||e.groupId,id:"order_group",name:"order_group",apiPath:e.groupApiPath,nonce:e.nonce,setGroupId:f}))),!!m&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("hr",null),(0,t.createElement)(i,{nonce:e.nonce,apiPath:e.productApiPath,lineItem:E,order:e.order,groupId:m,setStatus:I})),(0,t.createElement)("div",{class:"form-wrap"},d&&(0,t.createElement)(a.Notice,{status:d.status,isDismissable:!0,onDismiss:()=>u(null)},d.message),(0,t.createElement)("button",{disabled:h,type:"submit",class:"button save_order button-primary",name:"save",value:"Create"},S),v&&(0,t.createElement)(a.Spinner,null))))};window.addEventListener("load",(function(e){const a=document.querySelector("#lasntgadmin-orders-component");(0,t.render)((0,t.createElement)(f,{groupApiPath:a.dataset.groupApiPath,orderApiPath:a.dataset.orderApiPath,productApiPath:a.dataset.productApiPath,nonce:a.dataset.nonce,title:a.dataset.title,status:a.dataset.status,order:JSON.parse(a.dataset.order),orderId:a.dataset.orderId,groupId:JSON.parse(a.dataset.groupId),userId:a.dataset.userId,user:JSON.parse(a.dataset.user),userMeta:JSON.parse(a.dataset.userMeta)}),a)}),!1)}();